define(["./when-a8daa614","./createTaskProcessorWorker","./RuntimeError-3ea13d12","./WebGLConstants-18e33079"],(function(e,t,a,r){"use strict";var n,s,o={cTFETC1_RGB:0,cTFETC2_RGBA:1,cTFBC1_RGB:2,cTFBC3_RGBA:3,cTFBC4_R:4,cTFBC5_RG:5,cTFBC7_RGBA:6,cTFPVRTC1_4_RGB:8,cTFPVRTC1_4_RGBA:9,cTFASTC_4x4_RGBA:10,cTFRGBA32:13,cTFRGB565:14,cTFBGR565:15,cTFRGBA4444:16,cTFTotalTextureFormats:22},c={};function T(e,t){throw new a.RuntimeError("Error transcode for BASIS Texture, id: "+e+", error message: "+t)}function _(e,t,a){T(e,a),t.close(),t.delete()}c[o.cTFBC1_RGB]={format:r.WebGLConstants.COMPRESSED_RGB_S3TC_DXT1_EXT},c[o.cTFBC3_RGBA]={format:r.WebGLConstants.COMPRESSED_RGBA_S3TC_DXT5_EXT},c[o.cTFBC7_RGBA]={format:r.WebGLConstants.COMPRESSED_RGBA_BPTC_UNORM_EXT},c[o.cTFETC1_RGB]={format:r.WebGLConstants.COMPRESSED_RGB_ETC1_WEBGL},c[o.cTFETC2_RGBA]={format:r.WebGLConstants.COMPRESSED_RGBA8_ETC2_EAC},c[o.cTFASTC_4x4_RGBA]={format:r.WebGLConstants.COMPRESSED_RGBA_ASTC_4x4_KHR},c[o.cTFPVRTC1_4_RGB]={format:r.WebGLConstants.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},c[o.cTFPVRTC1_4_RGBA]={format:r.WebGLConstants.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},c[o.cTFRGBA32]={uncompressed:!0,format:r.WebGLConstants.RGBA,type:r.WebGLConstants.UNSIGNED_BYTE},c[o.cTFRGB565]={uncompressed:!0,format:r.WebGLConstants.RGB,type:r.WebGLConstants.UNSIGNED_SHORT_5_6_5},c[o.cTFRGBA4444]={uncompressed:!0,format:r.WebGLConstants.RGBA,type:r.WebGLConstants.UNSIGNED_SHORT_4_4_4_4};function B(e,t,a,r){var s=new Uint8Array(t),T=new n(s),B=T.getImageWidth(0,0),R=T.getImageHeight(0,0),G=(t=T.getNumImages(),T.getNumLevels(0));s=T.getHasAlpha();if(t&&G)if(T.startTranscoding()){var i,f=!1;if(s?a.etc2?i=o.cTFETC2_RGBA:a.bptc?i=o.cTFBC7_RGBA:a.s3tc?i=o.cTFBC3_RGBA:a.astc?i=o.cTFASTC_4x4_RGBA:a.pvrtc?r?(i=o.cTFPVRTC1_4_RGB,f=!0):i=o.cTFPVRTC1_4_RGBA:a.etc1&&r?(i=o.cTFETC1_RGB,f=!0):i=o.RGBA32:i=a.etc1?o.cTFETC1_RGB:a.bptc?o.cTFBC7_RGBA:a.s3tc?o.cTFBC1_RGB:a.etc2?o.cTFETC2_RGBA:a.astc?o.cTFASTC_4x4_RGBA:a.pvrtc?o.cTFPVRTC1_4_RGB:o.cTFRGB565,void 0!==i){(a=c[i]).uncompressed&&(G=1);for(var C=[],u=0,A=0;A<G;++A){var d=T.getImageTranscodedSizeInBytes(0,A,i);C.push({level:A,offset:u,size:d,width:T.getImageWidth(0,A),height:T.getImageHeight(0,A)}),u+=d}for(var l=new Uint8Array(u),F=f?new Uint8Array(u):null,m=0;m<C.length;++m){var E=C[m],S=new Uint8Array(l.buffer,E.offset,E.size);if(!T.transcodeImage(S,0,E.level,i,1,0))return void _(e,T,"transcodeImage failed");if(f&&(S=new Uint8Array(F.buffer,E.offset,E.size),!T.transcodeImage(S,0,E.level,i,1,1)))return void _(e,T,"alpha transcodeImage failed")}return T.close(),T.delete(),{id:e,data:l,width:B,height:R,alphaBuffer:f?F.buffer:null,webglFormat:a,mipmaps:C,hasAlpha:s}}_(e,T,"No supported transcode formats")}else _(e,T,"startTranscoding failed");else _(e,T,"Invalid Basis data")}function R(t){var a=t.url,r=t.buffer,o=t.allowSeparateAlpha,c=t.supportedFormats,_=t.id,R=e.when.defer();return a?fetch(a).then((function(e){e.ok?e.arrayBuffer().then((function(e){var t;n?(t=B(_,e,c,o),R.resolve(t)):s.then((function(){var t=B(_,e,c,o);R.resolve(t)}))})):T(_,"Fetch failed: "+e.status+", "+e.statusText)})):r?n?(a=B(_,r,c,o),R.resolve(a)):s.then((function(){var e=B(_,r,c,o);R.resolve(e)})):(T(_,"No url or buffer specified"),R.reject(!1)),R}return function(a){var r=a.data.webAssemblyConfig;if(e.defined(r))return require([r.modulePath],(function(a){!function(e,a){var r;r=a.wasmBinary,s=e({wasmBinary:r}).then((function(e){n=e.BasisFile,e.initializeBasis()})),self.onmessage=t(R),self.postMessage(!0)}(a=e.defined(a)?a:self.BASIS,r)}))}}));