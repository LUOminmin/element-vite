define(["./arrayRemoveDuplicates-98e917ed","./BoundingRectangle-f3757a69","./Transforms-d7f8120c","./Cartesian2-c2e87f25","./Check-3a7033c5","./ComponentDatatype-11643cbc","./CoplanarPolygonGeometryLibrary-c6a73634","./when-a8daa614","./GeometryAttribute-c85c47e3","./GeometryAttributes-1356486e","./GeometryInstance-656b99a6","./GeometryPipeline-6828c62b","./IndexDatatype-6ac58125","./Math-9c4212b4","./PolygonGeometryLibrary-d5117b69","./PolygonPipeline-caa2b3a7","./VertexFormat-26951076","./RuntimeError-3ea13d12","./WebGLConstants-18e33079","./OrientedBoundingBox-5bffc097","./EllipsoidTangentPlane-3927d699","./IntersectionTests-12c4c5cb","./Plane-44fc4194","./AttributeCompression-9d280301","./EncodedCartesian3-a26ebc30","./ArcType-b86a0fcb","./EllipsoidRhumbLine-1b27589f"],(function(e,t,a,n,r,o,i,l,s,p,c,y,m,u,d,g,b,h,C,v,f,x,P,w,A,F,G){"use strict";var L=new n.Cartesian3,E=new t.BoundingRectangle,T=new n.Cartesian2,D=new n.Cartesian2,_=new n.Cartesian3,k=new n.Cartesian3,V=new n.Cartesian3,R=new n.Cartesian3,I=new n.Cartesian3,M=new n.Cartesian3,H=new a.Quaternion,B=new a.Matrix3,O=new a.Matrix3,z=new n.Cartesian3;function S(e){var t=(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).polygonHierarchy,a=l.defaultValue(e.vertexFormat,b.VertexFormat.DEFAULT);this._vertexFormat=b.VertexFormat.clone(a),this._polygonHierarchy=t,this._stRotation=l.defaultValue(e.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(l.defaultValue(e.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=d.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+b.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}S.fromPositions=function(e){return new S({polygonHierarchy:{positions:(e=l.defaultValue(e,l.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},S.pack=function(e,t,a){return a=l.defaultValue(a,0),a=d.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,a),n.Ellipsoid.pack(e._ellipsoid,t,a),a+=n.Ellipsoid.packedLength,b.VertexFormat.pack(e._vertexFormat,t,a),a+=b.VertexFormat.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var N=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),Q=new b.VertexFormat,j={polygonHierarchy:{}};return S.unpack=function(e,t,a){t=l.defaultValue(t,0);var r=d.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=n.Ellipsoid.unpack(e,t,N);t+=n.Ellipsoid.packedLength;var i=b.VertexFormat.unpack(e,t,Q);t+=b.VertexFormat.packedLength;var s=e[t++];t=e[t];return(a=l.defined(a)?a:new S(j))._polygonHierarchy=r,a._ellipsoid=n.Ellipsoid.clone(o,a._ellipsoid),a._vertexFormat=b.VertexFormat.clone(i,a._vertexFormat),a._stRotation=s,a.packedLength=t,a},S.createGeometry=function(t){var r=t._vertexFormat,l=t._polygonHierarchy,b=t._stRotation,h=l.positions;if(!((h=e.arrayRemoveDuplicates(h,n.Cartesian3.equalsEpsilon,!0)).length<3)){var C=_,v=k,f=V,x=I,P=M;if(i.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(h,R,x,P)){C=n.Cartesian3.cross(x,P,C),C=n.Cartesian3.normalize(C,C),n.Cartesian3.equalsEpsilon(R,n.Cartesian3.ZERO,u.CesiumMath.EPSILON6)||(w=t._ellipsoid.geodeticSurfaceNormal(R,z),n.Cartesian3.dot(C,w)<0&&(C=n.Cartesian3.negate(C,C),x=n.Cartesian3.negate(x,x)));var w=i.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(R,x,P),A=i.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(R,x,P);r.tangent&&(v=n.Cartesian3.clone(x,v)),r.bitangent&&(f=n.Cartesian3.clone(P,f));w=(l=d.PolygonGeometryLibrary.polygonsFromHierarchy(l,w,!1)).hierarchy;var F=l.polygons;if(0!==w.length){h=w[0].outerRing,l=a.BoundingSphere.fromPoints(h);for(var G=d.PolygonGeometryLibrary.computeBoundingRectangle(C,A,h,b,E),S=[],N=0;N<F.length;N++){var Q=new c.GeometryInstance({geometry:function(e,t,r,i,l,c,y,d){var b=e.positions,h=g.PolygonPipeline.triangulate(e.positions2D,e.holes);h.length<3&&(h=[0,1,2]),(e=m.IndexDatatype.createTypedArray(b.length,h.length)).set(h);var C=B;0!==i?(h=a.Quaternion.fromAxisAngle(c,i,H),C=a.Matrix3.fromQuaternion(h,C),(t.tangent||t.bitangent)&&(h=a.Quaternion.fromAxisAngle(c,-i,H),x=a.Matrix3.fromQuaternion(h,O),y=n.Cartesian3.normalize(a.Matrix3.multiplyByVector(x,y,y),y),t.bitangent&&(d=n.Cartesian3.normalize(n.Cartesian3.cross(c,y,d),d)))):C=a.Matrix3.clone(a.Matrix3.IDENTITY,C);var v=D;t.st&&(v.x=r.x,v.y=r.y);for(var f=b.length,x=3*f,P=new Float64Array(x),w=t.normal?new Float32Array(x):void 0,A=t.tangent?new Float32Array(x):void 0,F=t.bitangent?new Float32Array(x):void 0,G=t.st?new Float32Array(2*f):void 0,E=0,_=0,k=0,V=0,R=0,I=0;I<f;I++){var M,z=b[I];P[E++]=z.x,P[E++]=z.y,P[E++]=z.z,t.st&&(M=l(a.Matrix3.multiplyByVector(C,z,L),T),n.Cartesian2.subtract(M,v,M),z=u.CesiumMath.clamp(M.x/r.width,0,1),M=u.CesiumMath.clamp(M.y/r.height,0,1),G[R++]=z,G[R++]=M),t.normal&&(w[_++]=c.x,w[_++]=c.y,w[_++]=c.z),t.tangent&&(A[V++]=y.x,A[V++]=y.y,A[V++]=y.z),t.bitangent&&(F[k++]=d.x,F[k++]=d.y,F[k++]=d.z)}return x=new p.GeometryAttributes,t.position&&(x.position=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:P})),t.normal&&(x.normal=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})),t.tangent&&(x.tangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),t.bitangent&&(x.bitangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:F})),t.st&&(x.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:G})),new s.Geometry({attributes:x,indices:e,primitiveType:s.PrimitiveType.TRIANGLES})}(F[N],r,G,b,A,C,v,f)});S.push(Q)}return(w=y.GeometryPipeline.combineInstances(S)[0]).attributes.position.values=new Float64Array(w.attributes.position.values),w.indices=m.IndexDatatype.createTypedArray(w.attributes.position.values.length/3,w.indices),h=w.attributes,r.position||delete h.position,new s.Geometry({attributes:h,indices:w.indices,primitiveType:w.primitiveType,boundingSphere:l})}}}},function(e,t){return l.defined(t)&&(e=S.unpack(e,t)),S.createGeometry(e)}}));